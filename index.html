<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>星语占星 Pro</title>
    <style>
        :root { --primary: #a29bfe; --bg: #0b0e21; --card: #1a1c3a; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* 配置区域 */
        .user-config { background: var(--card); padding: 15px; border-radius: 15px; width: 100%; max-width: 400px; margin-bottom: 20px; border: 1px solid #3d3f5e; box-sizing: border-box; }
        .input-group { display: flex; gap: 10px; margin-bottom: 10px; }
        input, select { background: #2d2f4e; border: 1px solid #3d3f5e; color: white; padding: 8px; border-radius: 8px; flex: 1; font-size: 14px; }

        /* 选项卡 */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; width: 100%; max-width: 400px; overflow-x: auto; padding-bottom: 5px; }
        .tab { padding: 8px 15px; background: var(--card); border-radius: 20px; font-size: 13px; white-space: nowrap; cursor: pointer; border: 1px solid #3d3f5e; }
        .tab.active { background: var(--primary); color: #0b0e21; font-weight: bold; }

        /* 星座网格 */
        #zodiac-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; width: 100%; max-width: 400px; }
        .zodiac-card { background: var(--card); padding: 15px 5px; border-radius: 12px; text-align: center; border: 1px solid #3d3f5e; cursor: pointer; transition: 0.2s; }
        .zodiac-card:active { transform: scale(0.95); background: #2d2f4e; }
        .icon { font-size: 24px; display: block; margin-bottom: 5px; }
        .name { font-size: 13px; opacity: 0.8; }

        /* 自定义弹窗 - 解决网址显示问题 */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 999; backdrop-filter: blur(8px); }
        .modal-content { background: #1a1c3a; width: 85%; max-width: 350px; border-radius: 24px; border: 1px solid var(--primary); overflow: hidden; }
        .modal-header { background: var(--primary); padding: 15px; text-align: center; font-weight: bold; color: #0b0e21; }
        .modal-body { padding: 20px; color: #dcdde1; }
        .report-item { margin-bottom: 15px; }
        .report-label { color: var(--primary); font-size: 12px; display: block; margin-bottom: 4px; }
        .report-val { font-size: 15px; line-height: 1.6; }
        .close-btn { width: 100%; padding: 15px; background: transparent; border: none; color: var(--primary); border-top: 1px solid #3d3f5e; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

    <h1 style="color:var(--primary)">星语占星 Pro</h1>

    <div class="user-config">
        <div class="input-group">
            <input type="date" id="birthDate" value="2000-01-01">
            <input type="time" id="birthTime" value="12:00">
        </div>
        <select id="risingSign">
            <option value="">点击选择上升星座 (可选)</option>
            <option value="白羊">上升白羊</option><option value="金牛">上升金牛</option>
            <option value="双子">上升双子</option><option value="巨蟹">上升巨蟹</option>
            <option value="狮子">上升狮子</option><option value="处女">上升处女</option>
            <option value="天秤">上升天秤</option><option value="天蝎">上升天蝎</option>
            <option value="射手">上升射手</option><option value="摩羯">上升摩羯</option>
            <option value="水瓶">上升水瓶</option><option value="双鱼">上升双鱼</option>
        </select>
    </div>

    <div class="tabs">
        <div class="tab active" data-mode="day">今日运势</div>
        <div class="tab" data-mode="week">周运</div>
        <div class="tab" data-mode="year">2026年运</div>
        <div class="tab" data-mode="mbti">玄学联动</div>
    </div>

    <div id="zodiac-container"></div>

    <div id="modalOverlay" class="modal-overlay">
        <div class="modal-content">
            <div id="modalHeader" class="modal-header"></div>
            <div class="modal-body" id="modalBody"></div>
            <button class="close-btn" onclick="closeModal()">我知道了</button>
        </div>
    </div>

    <script>
        // 1. 基础数据
        let currentMode = 'day';
        const zodiacs = [
            {n:'白羊', i:'♈'}, {n:'金牛', i:'♉'}, {n:'双子', i:'♊'}, 
            {n:'巨蟹', i:'♋'}, {n:'狮子', i:'♌'}, {n:'处女', i:'♍'},
            {n:'天秤', i:'♎'}, {n:'天蝎', i:'♏'}, {n:'射手', i:'♐'}, 
            {n:'摩羯', i:'♑'}, {n:'水瓶', i:'♒'}, {n:'双鱼', i:'♓'}
        ];

        const fortuneLib = {
            sun: ["事业运极佳，适合推进重要项目。", "建议多休息，避免过度劳累。", "财运波动，注意理性消费。", "沟通顺畅，适合化解往日误会。"],
            rising: ["会有突如其来的好消息。", "注意职场细节，防止小疏忽。", "社交运活跃，会结识新朋友。", "生活节奏变快，注意时间管理。"],
            moon: ["情绪平稳，适合学习新知识。", "直觉准确，适合做内心选择。", "容易感性，适合联系老友。", "精力充沛，适合户外运动。"]
        };

        // 2. 辅助工具
        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                hash = ((hash << 5) - hash) + str.charCodeAt(i);
                hash |= 0; 
            }
            return Math.abs(hash);
        }

        function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }

        // 3. 核心功能：生成内容
        function generateContent(name) {
            const birth = document.getElementById('birthDate').value;
            const today = new Date().toISOString().slice(0, 10); 
            const rising = document.getElementById('risingSign').value || name;
            const seed = hashCode(name + birth + today);
            
            document.getElementById('modalHeader').innerText = name + "座 · " + (currentMode === 'day' ? '今日运势' : '报告');
            let html = '';

            if(currentMode === 'day') {
                const s = fortuneLib.sun[seed % 4];
                const r = fortuneLib.rising[(seed+1) % 4];
                const m = fortuneLib.moon[(seed+2) % 4];
                html = `<div class="report-item"><span class="report-label">太阳(外在能量)</span><div class="report-val">${s}</div></div>
                        <div class="report-item"><span class="report-label">上升(${rising} 实际境遇)</span><div class="report-val">${r}</div></div>
                        <div class="report-item"><span class="report-label">月亮(内在情绪)</span><div class="report-val">${m}</div></div>`;
            } else if(currentMode === 'mbti') {
                const mbtis = ["INTJ", "ENFP", "INFJ", "ENTP", "INFP"];
                html = `<div class="report-item"><span class="report-label">人格联动</span><div class="report-val">根据星位指纹，你今日更接近 <b>${mbtis[seed % 5]}</b> 能量场。</div></div>`;
            } else {
                html = `<div class="report-item"><div class="report-val">此维度数据正在星历表中校准，请稍后重试。</div></div>`;
            }

            document.getElementById('modalBody').innerHTML = html;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        // 4. 页面加载完成后绑定事件
        window.onload = function() {
            // 绑定选项卡点击
            document.querySelectorAll('.tab').forEach(tab => {
                tab.onclick = function() {
                    document.querySelector('.tab.active').classList.remove('active');
                    this.classList.add('active');
                    currentMode = this.getAttribute('data-mode');
                }
            });

            // 渲染星座卡片并绑定点击
            const container = document.getElementById('zodiac-container');
            container.innerHTML = ''; // 清空
            zodiacs.forEach(item => {
                const card = document.createElement('div');
                card.className = 'zodiac-card';
                card.innerHTML = `<span class="icon">${item.i}</span><span class="name">${item.n}</span>`;
                // 直接在这里绑定事件
                card.onclick = function() { generateContent(item.n); };
                container.appendChild(card);
            });
        };
    </script>
</body>
</html>
